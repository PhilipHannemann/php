<?php
require_once("config.php");
/**
 * for managing the Malware Table
 */
class Malware
{
  private $conn;
  private $tableName = "Malware";

  public function __construct(){
     $db = new Database();
     $this->conn = $db->conn;
  }


  public function createTable(){
    $query = "CREATE TABLE $this->tableName (
       id INT NOT NULL AUTO_INCREMENT KEY,
	     name VARCHAR(32),
       signature VARCHAR(20));";

	  $result = $this->conn->query($query);
	  if (!$result) die ($this->conn->error);

  }

  public function delete($id){
    $query = "DELETE FROM $this->tableName WHERE id=$id";

    $result = $this->conn->query($query);
    if (!$result) die($this->conn->error);
  }

  public function insert($name, $signature){
    $query = "INSERT INTO $this->tableName
      (name, signature)
      VALUE('$name', '$signature');";

	  $result = $this->conn->query($query);
	  if (!$result) die($this->conn->error);

    echo "The new malware $name has been added to the database";
  }

  public function search($string){
    $query = "SELECT * FROM $this->tableName WHERE signature LIKE '%$string%';";

    $result = $this->conn->query($query);
    if (!$result) die($this->conn->error);

    $rows = $result->num_rows;

    echo "<br><center>";

    if ($rows === 0) {
      echo "The uploaded file is not a known malware";
      return;
    }

    echo "<h3>This file could be the following malware:</h3>";

    echo "<ul>";

    for ($j = 0 ; $j < $rows ; ++$j){
        $result->data_seek($j);
        $values = $result->fetch_assoc();

        echo "<li>".$values['name']."</li>";

    }

    echo "</ul>";
    echo "</center>";

    $result->close();

  }


}


?>
